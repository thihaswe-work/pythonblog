<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>{% block title %}My Blog{% endblock %}</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 text-gray-900 font-sans flex flex-col min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-md">
      <div class="container mx-auto flex justify-between items-center p-4">
        <h1 class="text-2xl font-bold text-blue-600">My Blog</h1>
        <nav class="flex items-center space-x-4">
          {% comment %} Define a helper to detect current page {% endcomment %}
          {% with request.path as current_path %}

          <a
            href="{% url 'post_list' %}"
            class="px-3 py-1 rounded hover:bg-blue-100 {% if current_path == '/' %}border-b-2 border-blue-600 font-semibold{% endif %}"
            >Home</a
          >

          {% if user.is_authenticated %}
          <span class="text-gray-500 px-3 py-1"
            >Logged in as {{ user.username }}</span
          >
          <a
            href="{% url 'user_posts' user.username %}"
            class="px-3 py-1 rounded hover:bg-yellow-100 {% if current_path == '/users/'|add:user.username|add:'/posts/' %}border-b-2 border-yellow-600 font-semibold{% endif %}"
            >My Posts</a
          >
          <a
            href="{% url 'edit_profile' %}"
            class="px-3 py-1 rounded hover:bg-green-100 {% if current_path == '/users/edit/' %}border-b-2 border-green-600 font-semibold{% endif %}"
          >
            Edit Profile
          </a>
          <a
            href="{% url 'category_list' %}"
            class="px-3 py-1 rounded hover:bg-purple-100 {% if current_path == '/categories/' %}border-b-2 border-purple-600 font-semibold{% endif %}"
            >Categories</a
          >
          <a
            href="{% url 'logout' %}"
            class="px-4 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition duration-200"
            >Logout</a
          >
          {% else %}

          <a
            href="{% url 'login' %}"
            class="px-4 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 transition duration-200 {% if current_path == '/users/login/' %}border-b-2 border-blue-700 font-semibold{% endif %}"
            >Login</a
          >
          <a
            href="{% url 'register' %}"
            class="px-4 py-1 bg-green-500 text-white rounded hover:bg-green-600 transition duration-200 {% if current_path == '/users/register/' %}border-b-2 border-green-700 font-semibold{% endif %}"
            >Register</a
          >
          {% endif %} {% endwith %}
        </nav>
      </div>
    </header>

    <!-- Main content -->
    <main
      class="container mx-auto mt-6 p-6 bg-white rounded-md shadow-md flex-1"
    >
      {% block content %}{% endblock %}

      <div></div>
      {% block session %}
      <div class="mt-4">
        <button
          id="increaseBtn"
          class="px-4 py-2 bg-blue-600 text-white rounded"
        >
          Increase
        </button>
        <button
          id="decreaseBtn"
          class="px-4 py-2 bg-red-600 text-white rounded"
        >
          Decrease
        </button>
        <span class="ml-3">Count: <span id="count">0</span></span>
      </div>

      <script>
        const countSpan = document.getElementById("count");

        // Load from server on page load
        fetch("/session/get/")
          .then((res) => res.json())
          .then((data) => (countSpan.textContent = data.count));

        document.getElementById("increaseBtn").onclick = () => {
          fetch("/session/increase/")
            .then((res) => res.json())
            .then((data) => (countSpan.textContent = data.count));
        };

        document.getElementById("decreaseBtn").onclick = () => {
          fetch("/session/decrease/")
            .then((res) => res.json())
            .then((data) => (countSpan.textContent = data.count));
        };
      </script>
      {% endblock %}
    </main>

    <!-- Footer -->
    <footer class="bg-white shadow-inner mt-6">
      <div class="container mx-auto p-4 text-center text-gray-500">
        Â© 2025 My Blog
      </div>
    </footer>
  </body>
</html>
